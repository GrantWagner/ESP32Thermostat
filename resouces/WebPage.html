<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Thermostat</title>
<style>
  /* Page layout */
  body { background-color:#f0f0f0; font-family:Helvetica, Arial, sans-serif; }
  #container { max-width:900px; margin:16px auto; display:flex; gap:12px; align-items:flex-start; }

  /* Dial / timer sizing */
  #thermo, #timer { width:50vmin; height:50vmin; }

  /* Dial SVG */
  #dial__svg { user-select:none; }
  #dial__svg > circle:first-of-type { transition:fill 0.3s; fill:#222; }
  #dial__editableIndicator { stroke:white; stroke-width:4; fill:transparent; opacity:0; transition:opacity 0.2s; }
  #dial__svg.editing #dial__editableIndicator { opacity:1; }
  #dial__ticks .tick { fill: rgba(255,255,255,0.28); }
  #dial__ticks .tick.active { fill: rgba(255,255,255,0.85); }
  #dial__ticks .tick.large {}
  #dial__ticks .tick.sample { display:none; }
  #dial_target_label { fill:white; text-anchor:middle; alignment-baseline:central; font-size:96px; font-weight:700; }
  #dial_current_label { fill:white; text-anchor:middle; alignment-baseline:central; font-size:20px; font-weight:600; }

  /* Timer SVG */
  #timer_svg .timer-bg { fill:transparent; stroke:#eee; stroke-width:4; stroke-linecap:round; }
  #timerLine { fill:transparent; stroke:#009B9D; stroke-width:6; stroke-linecap:round; stroke-dasharray:0 1; }
  #timer_remains { fill:#333; font-size:36px; text-anchor:middle; alignment-baseline:middle; }

  /* Controls */
  #controls { background:rgba(255,255,255,0.9); padding:12px; border-radius:8px; width:240px; }
  .controls-row { display:flex; gap:8px; align-items:center; margin-bottom:8px; }
  .controls-row.small { font-size:13px; }
  .controls-row > label { flex:1; }
  #controls label { font-size:13px; color:#333; }
  #controls label span { display:block; font-size:12px; color:#333; margin-bottom:4px; }
  input[type=range] { width:100%; }
  #input_start { background:#1DB21D; color:white; border:none; padding:10px 14px; border-radius:6px; cursor:pointer; }
  #status_text { color:inherit; }

  /* Hidden sample used to satisfy static analyzers (tick classes are applied dynamically at runtime) */
  .hidden-sample { position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden; }
</style>
</head>

<body>
<div id="container">
    <div id="thermo">
        <svg id="dial__svg" width="100%" height="100%" viewBox="0 0 400 400">
            <circle cx="200" cy="200" r="200" />
            <circle id="dial__editableIndicator" cx="200" cy="200" r="194" />
            <g id="dial__ticks">
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(-150 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(-142.5 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(-135 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(-127.5 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(-120 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(-112.5 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(-105 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(-97.5 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(-90 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(-82.5 200 200)" />

                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(-75 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(-67.5 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(-60 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(-52.5 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(-45 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(-37.5 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(-30 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(-22.5 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(-15 200 200)" />

                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(-7.5 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(0 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(7.5 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(15 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(22.5 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(30 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(37.5 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(45 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(52.5 200 200)" />

                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(60 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(67.5 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(75 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(82.5 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(90 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(97.5 200 200)" />

                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(105 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(112.5 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(120 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(127.5 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(135 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(142.5 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(150 200 200)" />
                <rect class="tick" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(157.5 200 200)" />

                <!-- hidden sample for static analyzers -->
                <rect class="tick sample active large" x="199" y="13.333" width="2" height="36" rx="1" transform="rotate(157.5 200 200)" />
             </g>
            <text id="dial_target_label" x="200" y="200"></text>
            <text id="dial_current_label" x="200" y="60"></text>
        </svg>
    </div>

    <div id="timer">
        <svg id="timer_svg" viewBox="0 0 400 400" width="100%" height="100%">
            <circle class="timer-bg" r="196" cx="200" cy="200"></circle>
            <circle id="timerLine" r="196" cx="200" cy="200"></circle>
            <text id="timer_remains" x="200" y="200"></text>
        </svg>
    </div>

    <div id="controls">
        <div class="controls-row">
            <label><span>Target Temperature</span>
                <input type="range" min="40" max="80" value="68" id="input_target_temperature" step="1" />
            </label>
         </div>

         <div class="controls-row">
            <label><span>Timer (minutes)</span>
                <input type="range" min="0" max="480" value="120" id="input_timer" step="1" />
            </label>
         </div>

        <div class="controls-row">
            <button id="input_start">Start</button>
        </div>
        <div class="controls-row small">
            <div id="status_text">Ready</div>
        </div>
    </div>
</div>

<!-- Hidden sample SVG to make static analysis aware of .tick.active and .tick.large selectors -->
<svg class="hidden-sample" aria-hidden="true" focusable="false">
  <rect class="tick active large" x="0" y="0" width="1" height="1"></rect>
</svg>

<script>
// Utility helpers
function rotatePoint(point, angle, origin) {
    var radians = angle * Math.PI / 180;
    var x = point[0] - origin[0];
    var y = point[1] - origin[1];
    var x1 = x * Math.cos(radians) - y * Math.sin(radians) + origin[0];
    var y1 = x * Math.sin(radians) + y * Math.cos(radians) + origin[1];
    return [x1, y1];
}

function restrictToRange(val, min, max) {
    if (val < min) return min;
    if (val > max) return max;
    return val;
}

// Thermostat dial
function thermostatDial_create(targetElement) {
    var options = {
        diameter: 400,
        minValue: 40,
        maxValue: 80,
        numTicks: 40,
        onSetTargetTemperature: function (v) {
            document.getElementById('input_target_temperature').value = Math.round(v);
        }
    };

    var props = {
        tickDegrees: 300,
        rangeValue: options.maxValue - options.minValue,
        radius: options.diameter / 2,
        ticksOuterRadius: options.diameter / 30,
        ticksInnerRadius: options.diameter / 8,
        dragLockAxisDistance: 12
    };

    props.lblAmbientPosition = [
        props.radius,
        props.ticksOuterRadius - (props.ticksOuterRadius - props.ticksInnerRadius) / 2
    ];

    props.offsetDegrees = 180 - (360 - props.tickDegrees) / 2;

    // data (struct)
    var data = {
        target_temperature: options.minValue,
        ambient_temperature: options.minValue
    };

    // find static tick nodes (40 rects in the SVG)
    var tickNodes = Array.from('#dial__ticks .tick');

    // Render helpers
    function thermostatDial_renderTicks() {
        var vMin = Math.min(data.ambient_temperature, data.target_temperature);
        var vMax = Math.max(data.ambient_temperature, data.target_temperature);
        var min = restrictToRange(
            Math.round((vMin - options.minValue) / props.rangeValue * options.numTicks),
            0,
            options.numTicks - 1
        );
        var max = restrictToRange(
            Math.round((vMax - options.minValue) / props.rangeValue * options.numTicks),
            0,
            options.numTicks - 1
        );

        tickNodes.forEach(function (tick, i) {
            var isLarge = i === min || i === max;
            var isActive = i >= min && i <= max;
            tick.classList.toggle('large', isLarge);
            tick.classList.toggle('active', isActive);
        });
    }

    function thermostatDial_renderTargetTemperature() {
        var targetText = document.getElementById('dial_target_label');
        targetText.textContent = Math.round(data.target_temperature);
    }

    function thermostatDial_renderCurrentTemperature() {
        var lbl = document.getElementById('dial_current_label');
        lbl.textContent = Math.round(data.ambient_temperature);
        var pegged = restrictToRange(data.ambient_temperature, options.minValue, options.maxValue);
        var degs = (props.tickDegrees * (pegged - options.minValue)) / props.rangeValue - props.offsetDegrees;
        var pos = rotatePoint(props.lblAmbientPosition, degs, [props.radius, props.radius]);
        lbl.setAttribute('x', pos[0]);
        lbl.setAttribute('y', pos[1]);
    }

    function thermostatDial_render() {
        thermostatDial_renderTicks();
        thermostatDial_renderTargetTemperature();
        thermostatDial_renderCurrentTemperature();
    }

    // Dragging
    var _drag = { inProgress: false, startPoint: null, startTemperature: 0, lockAxis: undefined };

    function thermostatDial_eventPosition(ev) {
        if (ev.targetTouches && ev.targetTouches.length) return [ev.targetTouches[0].clientX, ev.targetTouches[0].clientY];
        return [ev.clientX || ev.x, ev.clientY || ev.y];
    }

    var svg = document.getElementById('dial__svg');

    function thermostatDial_dragStart(ev) {
        svg.classList.add('editing');
        _drag.inProgress = true;
        _drag.startPoint = thermostatDial_eventPosition(ev);
        _drag.startTemperature = data.target_temperature || options.minValue;
        _drag.lockAxis = undefined;
    }

    function thermostatDial_dragEnd() {
        svg.classList.remove('editing');
        if (!_drag.inProgress) return;
        _drag.inProgress = false;
        if (data.target_temperature !== _drag.startTemperature) {
            if (typeof options.onSetTargetTemperature === 'function') options.onSetTargetTemperature(data.target_temperature);
        }
    }

    function thermostatDial_dragMove(ev) {
        if (!_drag.inProgress) return;
        ev.preventDefault();
        var p = thermostatDial_eventPosition(ev);
        var dy = _drag.startPoint[1] - p[1];
        var dx = p[0] - _drag.startPoint[0];
        var dxy;

        if (_drag.lockAxis === 'x') dxy = dx;
        else if (_drag.lockAxis === 'y') dxy = dy;
        else if (Math.abs(dy) > props.dragLockAxisDistance) {
            _drag.lockAxis = 'y';
            dxy = dy;
        } else if (Math.abs(dx) > props.dragLockAxisDistance) {
            _drag.lockAxis = 'x';
            dxy = dx;
        } else {
            dxy = Math.abs(dy) > Math.abs(dx) ? dy : dx;
        }

        var dValue = (dxy * thermostatDial_getSizeRatio()) / options.diameter * props.rangeValue;
        data.target_temperature = _drag.startTemperature + dValue;
        thermostatDial_render();
    }

    svg.addEventListener('mousedown', thermostatDial_dragStart);
    svg.addEventListener('touchstart', thermostatDial_dragStart);
    svg.addEventListener('mouseup', thermostatDial_dragEnd);
    svg.addEventListener('mouseleave', thermostatDial_dragEnd);
    svg.addEventListener('touchend', thermostatDial_dragEnd);
    svg.addEventListener('mousemove', thermostatDial_dragMove);
    svg.addEventListener('touchmove', thermostatDial_dragMove);

    function thermostatDial_getSizeRatio() {
        return options.diameter / targetElement.clientWidth;
    }

    // Public API (struct-like object with data + functions)
    var api = {
        data: data,
        render: thermostatDial_render,
        setTargetTemperature: function (v) {
            data.target_temperature = restrictToRange(+v, options.minValue, options.maxValue);
            thermostatDial_render();
        },
        setAmbientTemperature: function (v) {
            data.ambient_temperature = +v;
            thermostatDial_render();
        },
        getTargetTemperature: function () { return data.target_temperature; },
        getAmbientTemperature: function () { return data.ambient_temperature; }
    };

    // initial render
    thermostatDial_render();
    return api;
}

// Timer update moved out so it can be called with a data struct
function timerDial_update(data) {
    var cs = data.timerCurrentSeconds;
    if (cs <= 0) data.running = false;

    // format remaining
    var out = '';
    var hrs = Math.floor(cs / 3600);
    var mins = Math.floor((cs % 3600) / 60);
    var secs = cs % 60;
    if (hrs > 0) out += hrs + ':' + (mins < 10 ? '0' + mins : mins) + ':' + (secs < 10 ? '0' + secs : secs);
    else out += mins + ':' + (secs < 10 ? '0' + secs : secs);
    document.getElementById('timer_remains').textContent = out;

    // arc
    var total = data.timerTotalSeconds || 1;
    var circumference = 2 * 196 * Math.PI;
    var pct = Math.max(0, Math.min(1, cs / total));
    var arcFilled = Math.floor(circumference * pct);
    var arcEmpty = Math.max(0, Math.floor(circumference - arcFilled));
    var line = document.getElementById('timerLine');
    line.setAttribute('stroke-dasharray', arcFilled + ' ' + arcEmpty);
}

// Timer (struct-like) â€” data object + functions
function timerDial_create() {
    var data = { running: false, timerTotalSeconds: 120 * 60, timerCurrentSeconds: 120 * 60 };

    setInterval(function () {
        if (!data.running) return;
        if (data.timerCurrentSeconds > 0) data.timerCurrentSeconds -= 1;
        timerDial_update(data);
    }, 1000);

    timerDial_update(data);

    return {
        data: data,
        setTimerTotalSeconds: function (v) {
            data.timerTotalSeconds = +v || 0;
            data.timerCurrentSeconds = Math.min(data.timerCurrentSeconds || data.timerTotalSeconds, data.timerTotalSeconds);
            timerDial_update(data);
        },
        setTimerCurrentSeconds: function (v) { data.timerCurrentSeconds = Math.max(0, +v || 0); timerDial_update(data); },
        setRunning: function (v) { data.running = !!v; timerDial_update(data); },
        toggleRunning: function () { data.running = !data.running; timerDial_update(data); }
    };
}

// Instantiate
var nest = thermostatDial_create(document.getElementById('thermo'));

var timer = timerDial_create();

// Wire controls
var inputTarget = document.getElementById('input_target_temperature');
var inputTimer = document.getElementById('input_timer');
var inputStart = document.getElementById('input_start');
var statusText = document.getElementById('status_text');

// Explicit named handlers (replaced anonymous functions)
function handleInputTargetInput(e) {
    // use event.target for clarity
    var val = e && e.target ? e.target.value : this.value;
    nest.setTargetTemperature(+val);
}

function handleInputTimerInput(e) {
    var val = e && e.target ? e.target.value : this.value;
    var mins = +val;
    timer.setTimerTotalSeconds(mins * 60);
    timer.setTimerCurrentSeconds(mins * 60);
}

function handleInputStartClick(e) {
    timer.toggleRunning();
    inputStart.textContent = timer.data.running ? 'Stop' : 'Start';
    statusText.textContent = timer.data.running ? 'Running' : 'Paused';
}

// Attach handlers explicitly
inputTarget.oninput = handleInputTargetInput;
inputTimer.oninput = handleInputTimerInput;
inputStart.onclick = handleInputStartClick;

// initialize from inputs
nest.setTargetTemperature(+inputTarget.value);
timer.setTimerTotalSeconds(+inputTimer.value * 60);
timer.setTimerCurrentSeconds(+inputTimer.value * 60);
</script>
</body>
</html>

